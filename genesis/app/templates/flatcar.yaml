variant: flatcar
version: 1.0.0
systemd:
  units:
  - name: k3s-install.service
    enabled: true
    contents: |
      [Unit]
      Description=K3s install
      Wants=network-online.target
      After=network-online.target
      ConditionFirstBoot=yes
      [Service]
      Type=oneshot
      Restart=on-failure
      RemainAfterExit=true
      ExecStart=/usr/bin/bash -c 'set -e -o pipefail ; curl -sfL https://get.k3s.io | INSTALL_K3S_VERSION="v1.34.3+k3s1" sh -'
      [Install]
      WantedBy=multi-user.target
passwd:
  users:
  - name: core
    ssh_authorized_keys:
    - "{{ ssh_authorized_key }}"
